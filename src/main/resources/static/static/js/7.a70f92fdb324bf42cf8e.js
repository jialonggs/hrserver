webpackJsonp([7],{"21AK":function(e,t,a){var r={"./OfferBus.vue":"IyNY","./OfferBusAdd.vue":"hgxk","./OfferBusInfo.vue":"oyck","./OfferPer.vue":"K2PY","./OfferPerAdd.vue":"hBiO","./OfferPerInfo.vue":"O/7I"};function i(e){return a(o(e))}function o(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id="21AK"},IyNY:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={data:function(){return{dialogFormVisible:!1,username:"",name:"",uid:"",showTab:1,tableLoading:!1,currentPage:1,totalnum:0,pagesize:10,select_word:"",tableData:[],form:{finalBaoJia:0},itemYouHui:{}}},methods:{toYouHui:function(e){this.itemYouHui=e,this.dialogFormVisible=!0,this.form.finalBaoJia=0},toAddYouHui:function(){var e=this,t={id:this.itemYouHui.id,tax:this.itemYouHui.tax,finalBaoJia:this.form.finalBaoJia};this.postRequest("/offer/bus/update/final/baojia",t).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("设置成功"),e.getCollectMouldList(),e.dialogFormVisible=!1):(e.$message.error("设置失败"),e.dialogFormVisible=!1)})},dayin:function(e){var t=e.id;this.$router.push("/print/bus/"+t)},toinfo:function(e){this.$router.push("/offer/bus/info/"+e)},toadd:function(){this.$router.push("/offer/bus/add")},handleSizeChange:function(e){this.pagesize=e,this.getCollectMouldList()},handleCurrentChange:function(e){this.currentPage=e,this.getCollectMouldList()},getCollectMouldList:function(){var e=this;this.getRequest("/offer/bus/listbypage?page="+this.currentPage+"&size="+this.pagesize+"&addUserId="+this.uid).then(function(t){e.tableLoading=!1,t&&200==t.status&&0==t.data.code&&(e.tableData=t.data.data.busbaojialist,e.totalnum=t.data.data.count)})}},mounted:function(){this.$nextTick(function(){this.tableLoading=!0,this.getCollectMouldList()}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name")}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.showTab,expression:"showTab ==1"}]},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("商务报价")]),e._v(" "),a("el-breadcrumb-item",[e._v("商务报价列表")])],1)],1),e._v(" "),a("el-container",[a("el-header",{staticStyle:{padding:"0px",display:"flex","justify-content":"space-between","align-items":"center","margin-top":"30px"}},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"mr10",attrs:{type:"primary",icon:"plus"},on:{click:e.toadd}},[e._v("增添商务价单")]),e._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"筛选关键词",icon:"search"},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}})],1)]),e._v(" "),a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px","margin-top":"20px"}},[a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[a("el-table-column",{attrs:{label:"客户单位",prop:"clientCompanyName"}}),e._v(" "),a("el-table-column",{attrs:{label:"车型",prop:"carType"}}),e._v(" "),a("el-table-column",{attrs:{label:"审核状态",prop:"aduit"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.audit+""=="0"?a("el-tag",{attrs:{type:"info"}},[e._v("审核中")]):e._e(),e._v(" "),t.row.audit+""=="1"?a("el-tag",{attrs:{type:"success"}},[e._v("通过")]):e._e(),e._v(" "),t.row.audit+""=="2"?a("el-tag",{attrs:{type:"danger"}},[e._v("驳回")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"初次报价(含税)",prop:"total"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v("不含税价: "+e._s(t.row.noTaxTotal))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("span",{attrs:{size:"medium"}},[e._v(e._s(t.row.total))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"税率",prop:"tax"}}),e._v(" "),a("el-table-column",{attrs:{label:"最终价格(含税)",prop:"finalBaoJia"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v("不含税价: "+e._s(t.row.noTaxfinalBaoJia))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("span",{attrs:{size:"medium"}},[e._v(e._s(t.row.finalBaoJia))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatDateTime")(t.row.createTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.toinfo(t.row.id)}}},[e._v("详情")]),e._v(" "),t.row.submitType+""=="0"?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){e.dayin(t.row)}}},[e._v("打印")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.toYouHui(t.row)}}},[e._v("优惠价")])]}}])})],1)],1)])],1),e._v(" "),a("div",{staticClass:"block",staticStyle:{float:"right","margin-top":"15px"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,30,80,100],"page-size":e.pagesize,layout:"total,sizes, prev, pager, next, jumper",total:e.totalnum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"设置最终优惠价格",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"最终优惠价格："}},[a("el-input-number",{attrs:{min:0},model:{value:e.form.finalBaoJia,callback:function(t){e.$set(e.form,"finalBaoJia",t)},expression:"form.finalBaoJia"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.toAddYouHui}},[e._v("确 定")])],1)],1)],1)])},staticRenderFns:[]};var o=a("Z0/y")(r,i,!1,function(e){a("hMWY")},"data-v-7eaa11fd",null);t.default=o.exports},K2PY:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={data:function(){return{dialogFormVisible:!1,username:"",name:"",uid:"",showTab:1,tableLoading:!1,currentPage:1,totalnum:0,pagesize:10,select_word:"",tableData:[],form:{finalBaoJia:0},itemYouHui:{}}},methods:{toYouHui:function(e){this.itemYouHui=e,this.dialogFormVisible=!0,this.form.finalBaoJia=0},toAddYouHui:function(){var e=this,t={id:this.itemYouHui.id,tax:this.itemYouHui.tax,finalBaoJia:this.form.finalBaoJia};this.postRequest("/offer/per/update/final/baojia",t).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("设置成功"),e.getCollectMouldList(),e.dialogFormVisible=!1):(e.$message.error("设置失败"),e.dialogFormVisible=!1)})},toinfo:function(e){this.$router.push("/offer/per/info/"+e)},toadd:function(){this.$router.push("/offer/per/add")},handleSizeChange:function(e){this.pagesize=e,this.getCollectMouldList()},handleCurrentChange:function(e){this.currentPage=e,this.getCollectMouldList()},getCollectMouldList:function(){var e=this;this.getRequest("/offer/per/listbypage?page="+this.currentPage+"&size="+this.pagesize+"&addUserId="+this.uid).then(function(t){e.tableLoading=!1,t&&200==t.status&&0==t.data.code&&(e.tableData=t.data.data.yubaojialist,e.totalnum=t.data.data.count)})}},mounted:function(){this.$nextTick(function(){this.tableLoading=!0,this.getCollectMouldList()}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name")}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.showTab,expression:"showTab ==1"}]},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("预报价")]),e._v(" "),a("el-breadcrumb-item",[e._v("预报价列表")])],1)],1),e._v(" "),a("el-container",[a("el-header",{staticStyle:{padding:"0px",display:"flex","justify-content":"space-between","align-items":"center","margin-top":"30px"}},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"mr10",attrs:{type:"primary",icon:"plus"},on:{click:e.toadd}},[e._v("增添预报价单")]),e._v(" "),a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"筛选关键词",icon:"search"},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}})],1)]),e._v(" "),a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px","margin-top":"20px"}},[a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[a("el-table-column",{attrs:{label:"客户单位",prop:"clientCompanyName"}}),e._v(" "),a("el-table-column",{attrs:{label:"车型",prop:"carType"}}),e._v(" "),a("el-table-column",{attrs:{label:"审核状态",prop:"aduit"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.audit+""=="0"?a("el-tag",{attrs:{type:"info"}},[e._v("审核中")]):e._e(),e._v(" "),t.row.audit+""=="1"?a("el-tag",{attrs:{type:"success"}},[e._v("通过")]):e._e(),e._v(" "),t.row.audit+""=="2"?a("el-tag",{attrs:{type:"danger"}},[e._v("驳回")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"最终价格(含税)",prop:"finalBaoJia"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v("不含税价: "+e._s(t.row.noTaxfinalBaoJia))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("span",{attrs:{size:"medium"}},[e._v(e._s(t.row.finalBaoJia))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"税率",prop:"tax"}}),e._v(" "),a("el-table-column",{attrs:{label:"初次报价(含税)",prop:"total"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v("不含税价: "+e._s(t.row.noTaxTotal))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("span",{attrs:{size:"medium"}},[e._v(e._s(t.row.total))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatDateTime")(t.row.createTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.toinfo(t.row.id)}}},[e._v("详情")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.toYouHui(t.row)}}},[e._v("优惠价")])]}}])})],1)],1)])],1),e._v(" "),a("div",{staticClass:"block",staticStyle:{float:"right","margin-top":"15px"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,30,80,100],"page-size":e.pagesize,layout:"total,sizes, prev, pager, next, jumper",total:e.totalnum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"设置最终优惠价格",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"最终优惠价格："}},[a("el-input-number",{attrs:{min:0},model:{value:e.form.finalBaoJia,callback:function(t){e.$set(e.form,"finalBaoJia",t)},expression:"form.finalBaoJia"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.toAddYouHui}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var o=a("Z0/y")(r,i,!1,function(e){a("tQgA")},"data-v-1fc5b956",null);t.default=o.exports},"O/7I":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),i=a.n(r),o=a("a3Yh"),l=a.n(o),s=a("OIbc"),n=a("+J3q"),u={components:{VueCoreImageUpload:s.default},props:{title:String},data:function(){var e;return e={remarks:[],wen_jian_url:"",wenjianData:{userId:"",imgPakage:"yu_bao_jia"},imageData:{userId:"",imgPakage:"order_pm"},itemRow:{},upload:"",itemIndex:"",innerVisible:!1,udapteBoolean:!1,urlId:"",table_loading:!1,imageUrls:[],ruleForm:{tax:"16",addUserId:"",addUserName:""},rules:{productName:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],wenlidaima:[{required:!0,message:"请输入纹理代码",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],carType:[{required:!0,message:"请输入车型",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],clientCompanyName:[{required:!0,message:"请输入客户单位",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPerson:[{required:!0,message:"请输入预报价单名称",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系人电话",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],paytype:[{required:!0,message:"请输入付款方式",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],deliverytime:[{required:!0,message:"请输入加工周期",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],remark:[{min:0,max:2048,message:"长度在 0 到 2048 个字符",trigger:"blur"}]},elform:{},productData:[]},l()(e,"innerVisible",!1),l()(e,"tableData",[]),l()(e,"select_word",""),l()(e,"nowTab",1),e},methods:{toback:function(){this.$router.push("/offer/per/list")},toDownLoad:function(e){window.open(e)},toimageupwenjian:function(e){var t=this;this.$confirm("此操作将覆盖原上传文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.imageupwenjian(e)}).catch(function(){t.$message({type:"info",message:"已取消上传"})})},imageupwenjian:function(e){var t;t=e.url,this.wen_jian_url=t[0],this.ruleForm.fileUrl=this.wen_jian_url,this.$message.success("上传成功")},toAgain:function(){var e=this;this.postRequest("/offer/per/again/audit",this.ruleForm).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("重新提交成功"),e.$router.push("/offer/per/list/")):e.$message.error("提交失败")})},toadd:function(){this.innerVisible=!0,this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.imageUrls=[]},commit:function(){var e=this.productData;"undefined"==e||e.length<=0?this.$message.error("请添加产品详情"):this.addYuBaoJia()},addYuBaoJia:function(){var e=this,t=this,a=t.ruleForm;a.addUserId=this.uid,a.addUserName=this.name,a.submitType=0,this.postRequest("/offer/per/add",a).then(function(a){if(a&&200==a.status&&0==a.data.code){var r=a.data.data.id;r>0?e.addProduct(r):t.$message.error("添加基础信息失败")}else t.$message.error("添加基础信息失败")})},addProduct:function(e){var t=this;this.table_loading=!0;for(var a=this,r=a.productData,o="",l=0;l<r.length;l++){var s=r[l];s.addUserId=this.uid,s.addUserName=this.name,s.yuBaoJiaId=e,s.picUrls=this.toPinjieUrl(s.picUrls),o=o+i()(s)+"|"}var n={yuBaoJiaId:e,yuProducts:o};this.postRequest("/offer/per/add/product",n).then(function(e){t.table_loading=!1,e&&200==e.status&&0==e.data.code?(a.$message.success("添加成功"),t.$router.push("/offer/per/list")):a.$message.error("添加失败")})},deleteRow:function(e,t){var a=t[e].id;this.delProduct(a,e,t)},toAadd:function(){this.innerVisible=!0,this.udapteBoolean=!1,this.resetForm("elform")},toEidtor:function(e,t){this.udapteBoolean=!0;var a;a=t,this.itemRow=a[e],this.elform=this.itemRow,this.imageUrls=this.itemRow.picUrls,this.itemIndex=e,this.innerVisible=!0},todelProduct:function(e,t,a){var r=this,i=a[t];this.postRequest("/offer/per/del?product=",i).then(function(e){e&&200==e.status&&0==e.data.code?(r.$message.success("删除成功"),a.splice(t,1)):self.$message.error("删除失败")})},delProduct:function(e,t,a){var r=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.todelProduct(e,t,a)}).catch(function(){r.$message({type:"info",message:"已取消删除"})})},delMouldImage:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.todelImage(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},todelImage:function(e){var t=this;"undefined"!=e&&""!=e.length?this.getRequest("/config/delfile/delImage?url="+e).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("删除成功");for(var r=t.imageUrls,i=[],o=0;o<r.length;o++)e!=r[o]&&i.push(r[o]);t.imageUrls=i}else t.$message.error("删除照片失败")}):t.$message.error("删除图片不存在")},splitUrl:function(e){var t=e.picUrls,a=[];return"undefined"!=t&&""!=t&&(a=t.split("|")),a},toAudit:function(e){var t=this,a={id:this.urlId,audit:e,addUserId:this.ruleForm.addUserId,auditId:this.uid,auditName:this.name};this.postRequest("/audit/per/check",a).then(function(e){e&&200==e.status&&0==e.data.code?(t.$message.success("执行成功"),t.$store.state.stomp.send("/ws/nf",{},""),t.$router.push("/audit/per")):t.$message.error("执行失败")})},handleError:function(){this.$notify.error({title:"上传失败",message:"图片上传出现异常"})},toAddProduct:function(){var e=this,t=e.elform.price*e.elform.productNum*(e.ruleForm.tax/100+1),a=(0,this.$options.filters.imageFilter)(e.imageUrls),r={yuBaoJiaId:e.ruleForm.id,productName:e.elform.productName,wenlidaima:e.elform.wenlidaima,productNum:e.elform.productNum,area:e.elform.area,dongMo:e.elform.dongMo,coefficient:e.elform.coefficient,price:e.elform.price,picUrls:a,tax:e.ruleForm.tax,noTaxPrice:e.elform.price*e.elform.productNum,total:t,immutable:!1,addUserId:this.uid,addUserName:this.name};this.postRequest("/offer/per/add/new/product",r).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("新增成功"),r.picUrls=e.imageUrls,e.productData.push(r),e.imageUrls=[],e.resetForm("elform"),e.innerVisible=!1):e.$message.error("新增失败")})},imageuploaded:function(e){if("undefined"!==e.url.length&&e.url.length>0){for(var t=e.url,a=this.imageUrls,r=0;r<t.length;r++)a.push(t[r]);this.imageUrls=a}},getInfo:function(e){var t=this,a=this;this.getRequest("/offer/per/info?id="+e).then(function(e){if(e&&200==e.status&&0==e.data.code){a.ruleForm=e.data.data.yuinfo;var r=e.data.data.yuinfo.yuProductList,i=e.data.data.yuinfo.rejectRemark,o=t.$options.filters.splitRejectRemark;if(t.remarks=o(i),"undefined"!=a.product&&r.length>0){for(var l=[],s=0;s<r.length;s++){var n,u={};u=r[s],n=(o=t.$options.filters.splitUrl)(r[s].picUrls),u.picUrls=n,l.push(u)}a.productData=l}}else a.$message.error("获取失败")})},toUpdateProduct:function(){var e=this,t=this,a=t.elform.price*t.elform.productNum*(t.ruleForm.tax/100+1),r=(0,this.$options.filters.imageFilter)(t.imageUrls),i={yuBaoJiaId:t.ruleForm.id,id:t.elform.id,productName:t.elform.productName,wenlidaima:t.elform.wenlidaima,productNum:t.elform.productNum,area:t.elform.area,dongMo:t.elform.dongMo,coefficient:t.elform.coefficient,price:t.elform.price,picUrls:r,tax:t.ruleForm.tax,noTaxPrice:t.elform.price*t.elform.productNum,total:a,immutable:!1,addUserId:this.uid,addUserName:this.name};this.postRequest("/offer/per/update/product",i).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("更新成功");var r=[];i.picUrls=t.imageUrls;for(var o=0;o<e.productData.length;o++)o==e.itemIndex?r.push(i):r.push(e.productData[o]);e.$nextTick(function(){this.productData=r}),t.imageUrls=[],t.resetForm("elform"),t.innerVisible=!1}else t.$message.error("更新失败")})},chanel:function(){this.innerVisible=!1,this.udapteBoolean=!1},resetForm:function(e){this.$refs[e].resetFields()}},mounted:function(){this.$nextTick(function(){this.imageData.userId=this.uid=localStorage.getItem("cp_uid"),this.wenjianData.userId=this.uid=localStorage.getItem("cp_uid"),this.upload=n.a.upload}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name"),this.upload=n.a.upload},created:function(){this.urlId=this.$route.params.id,this.getInfo(this.urlId)}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("预报价单")]),e._v(" "),a("el-breadcrumb-item",[e._v("预报价详情")])],1)],1),e._v(" "),a("el-container",[a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px"}},[e.ruleForm.audit+""=="2"?a("div",[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("span",[e._v("驳回原因:")]),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},e._l(e.remarks,function(e){return a("div",[a("el-alert",{attrs:{title:e,type:"warning",closable:!1}})],1)}))])],1):e._e(),e._v(" "),a("div",[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.ruleForm,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.clientCompanyName,callback:function(t){e.$set(e.ruleForm,"clientCompanyName",t)},expression:"ruleForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.contactPerson,callback:function(t){e.$set(e.ruleForm,"contactPerson",t)},expression:"ruleForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.contactPhone,callback:function(t){e.$set(e.ruleForm,"contactPhone",t)},expression:"ruleForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.carType,callback:function(t){e.$set(e.ruleForm,"carType",t)},expression:"ruleForm.carType"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"不含税总价：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.noTaxTotal,callback:function(t){e.$set(e.ruleForm,"noTaxTotal",t)},expression:"ruleForm.noTaxTotal"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.tax,callback:function(t){e.$set(e.ruleForm,"tax",t)},expression:"ruleForm.tax"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"含税总价：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.total,callback:function(t){e.$set(e.ruleForm,"total",t)},expression:"ruleForm.total"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"最终优惠价格：",prop:"finalBaoJia"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:!0},model:{value:e.ruleForm.finalBaoJia,callback:function(t){e.$set(e.ruleForm,"finalBaoJia",t)},expression:"ruleForm.finalBaoJia"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"下载原文件",prop:"remark"}},[[a("a",{staticStyle:{color:"blue"},attrs:{href:e.ruleForm.fuJianUrl,download:"w3logo"}},[e._v("下载原文件")])]],2):e._e(),e._v(" "),e.ruleForm.submitType+""=="1"&&e.ruleForm.audit+""=="2"?a("el-form-item",{attrs:{label:"重新上传文件："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.wen_jian_url,expression:"wen_jian_url !== ''"}]},[a("p",{staticStyle:{color:"blue"}},[e._v("上传成功")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:""===e.wen_jian_url,expression:"wen_jian_url === ''"}]},[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,ppt,docx,txt,jpg,xlsx,pdf","max-file-size":5242880,data:e.wenjianData,text:"重新上传文件",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.toimageupwenjian,errorhandle:e.handleError}})],1)]):e._e()],1)])],1)],1),e._v(" "),e.ruleForm.submitType+""=="0"?a("div",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.table_loading,expression:"table_loading"}],staticClass:"box-card",staticStyle:{"margin-top":"25px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("产品列表")]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[e.ruleForm.audit+""=="2"?a("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:e.toadd}},[e._v("添加")]):e._e()],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productData,border:""}},[a("el-table-column",{attrs:{fixed:"",prop:"productName",label:"产品名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"image",staticStyle:{height:"30px",width:"30px"},attrs:{src:e.row.picUrls[0]}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:t.row.picUrls[0],target:"_blank"}},[e._v("点击查看")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"wenlidaima",label:"纹理代码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productNum",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"total",label:"含税"}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"area",label:"面积"}}),e._v(" "),a("el-table-column",{attrs:{prop:"noTaxPrice",label:"不含税价格"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.ruleForm.audit+""=="2"?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.toEidtor(t.$index,e.productData)}}},[e._v("编辑")]):e._e(),e._v(" "),e.ruleForm.audit+""=="2"?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.deleteRow(t.$index,e.productData)}}},[e._v("\r\n                      移除\r\n                    ")]):e._e()]}}])})],1)],1)]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right","margin-top":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.toback}},[e._v("返回列表")])],1)],1):e._e(),e._v(" "),e.ruleForm.audit+""=="2"?a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.toAgain}},[e._v("重新提交")])],1)]):e._e(),e._v(" "),a("div",[a("el-dialog",{attrs:{width:"60%",title:"产品详情",visible:e.innerVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("el-form",{ref:"elform",staticStyle:{width:"100%"},attrs:{model:e.elform,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"产品名称：",prop:"productName"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品名称"},model:{value:e.elform.productName,callback:function(t){e.$set(e.elform,"productName",t)},expression:"elform.productName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"纹理代码：",prop:"wenlidaima"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入纹理代码"},model:{value:e.elform.wenlidaima,callback:function(t){e.$set(e.elform,"wenlidaima",t)},expression:"elform.wenlidaima"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品数量：",prop:"productNum"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.elform.productNum,callback:function(t){e.$set(e.elform,"productNum",t)},expression:"elform.productNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"面积：",prop:"area"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.area,callback:function(t){e.$set(e.elform,"area",t)},expression:"elform.area"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有无动模："}},[a("el-switch",{model:{value:e.elform.dongMo,callback:function(t){e.$set(e.elform,"dongMo",t)},expression:"elform.dongMo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系数：",prop:"coefficient"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品系数"},model:{value:e.elform.coefficient,callback:function(t){e.$set(e.elform,"coefficient",t)},expression:"elform.coefficient"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单价：",prop:"price"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.price,callback:function(t){e.$set(e.elform,"price",t)},expression:"elform.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传图片："}},[a("div",[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,gif,jpeg,jpg","max-file-size":5242880,data:e.imageData,text:"上传图片",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageuploaded,errorhandle:e.handleError}})],1)])],1),e._v(" "),a("div",{staticStyle:{border:"1px dashed #d9d9d9",width:"100%","min-height":"358px"}},[a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},e._l(e.imageUrls,function(t){return a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"mould-card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{height:"320px"},attrs:{src:t}}),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.delMouldImage(t)}}},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}})])],1)])],1)}))],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.udapteBoolean,expression:"!udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toAddProduct}},[e._v("确 定")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.udapteBoolean,expression:"udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toUpdateProduct}},[e._v("更 新")]),e._v(" "),a("el-button",{on:{click:e.chanel}},[e._v("取 消")])],1)],1)],1)])],1)],1)])},staticRenderFns:[]},m=a("Z0/y")(u,c,!1,null,null,null);t.default=m.exports},hBiO:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),i=a.n(r),o=a("OIbc"),l=a("+J3q"),s={components:{VueCoreImageUpload:o.default},props:{title:String},data:function(){return{projectAll:[],wen_jian_url:"",upload:"",fujianForm:{tax:16,noTaxTotal:"0",total:"0"},udapteBoolean:!1,activeName:"first",itemIndex:"",wenjianData:{userId:"",imgPakage:"yu_bao_jia"},itemRow:{},imageData:{userId:"",imgPakage:"yu_bao_jia"},table_loading:!1,imageUrls:[],ruleForm:{tax:"16",addUserId:"",addUserName:""},elform:{productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},productData:[],restaurants3:[],innerVisible:!1,tableData:[],select_word:"",nowTab:1,rules:{productName:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],wenlidaima:[{required:!0,message:"请输入纹理代码",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],carType:[{required:!0,message:"请输入车型",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],clientCompanyName:[{required:!0,message:"请输入客户单位",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPerson:[{required:!0,message:"请输入预报价单名称",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系人电话",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],paytype:[{required:!0,message:"请输入付款方式",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],deliverytime:[{required:!0,message:"请输入加工周期",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],remark:[{min:0,max:2048,message:"长度在 0 到 2048 个字符",trigger:"blur"}]}}},methods:{toSelect1:function(){if("undefined"!==this.ruleForm.projectId&&"undefined"!=this.projectAll)for(var e=0;e<this.projectAll.length;e++)this.ruleForm.projectId==this.projectAll[e].id&&(this.ruleForm.carType=this.projectAll[e].car.name,this.ruleForm.clientCompanyName=this.projectAll[e].processUnit.clientCompanyName,this.ruleForm.contactPerson=this.projectAll[e].processUnit.contactPerson,this.ruleForm.contactPhone=this.projectAll[e].processUnit.contactPhone)},toSelect:function(){if("undefined"!==this.fujianForm.projectId&&"undefined"!=this.projectAll)for(var e=0;e<this.projectAll.length;e++)this.fujianForm.projectId==this.projectAll[e].id&&(this.fujianForm.carType=this.projectAll[e].car.name,this.fujianForm.clientCompanyName=this.projectAll[e].processUnit.clientCompanyName,this.fujianForm.contactPerson=this.projectAll[e].processUnit.contactPerson,this.fujianForm.contactPhone=this.projectAll[e].processUnit.contactPhone)},toChange:function(){var e=0;e=this.fujianForm.noTaxTotal*(100+this.fujianForm.tax)/100,this.fujianForm.total=e.toFixed(2)},toChange1:function(){var e=0;e=this.fujianForm.total/(100+this.fujianForm.tax)*100,this.fujianForm.noTaxTotal=e.toFixed(2)},toChange2:function(){var e=0;e=this.elform.noTaxPrice*(100+this.ruleForm.tax)/100,this.elform.total=e.toFixed(2)},toChange3:function(){var e=0;e=this.elform.total/(100+this.ruleForm.tax)*100,this.elform.noTaxPrice=e.toFixed(2)},tiJiao:function(){var e=this,t=this;if(""==this.wen_jian_url||this.wen_jian_url.length<=0)this.$message.error("请上传附件");else{var a=t.fujianForm;a.addUserId=this.uid,a.addUserName=this.name,a.total=this.totalPrice,a.submitType=1,a.fuJianUrl=this.wen_jian_url;var r={yuProductList:[],yuBaoJia:a};this.jsonPostRequest("/offer/per/add",r).then(function(a){a&&200==a.status&&0==a.data.code?(t.$message.success("添加成功"),e.$router.push("/offer/per/list")):t.$message.error(a.data.message)})}},imageupwenjian:function(e){this.$message.success("上传成功");var t;"undefinded"!=(t=e.url)&&t.length>0&&(this.wen_jian_url=t[0])},toAadd:function(){this.innerVisible=!0,this.udapteBoolean=!1,this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.imageUrls=[]},chanel:function(){this.innerVisible=!1,this.udapteBoolean=!1},commit:function(){var e=this.productData;"undefined"==e||e.length<=0?this.$message.error("请添加产品详情"):this.addYuBaoJia()},addYuBaoJia:function(){var e=this,t=this,a=t.ruleForm;a.addUserId=this.uid,a.addUserName=this.name,a.submitType=0,this.table_loading=!0;var r=t.productData;if("undefined"==r||r.length<=0)this.$message.error("请录入产品详情");else{for(var i=0,o=0,l=[],s=0;s<r.length;s++){var n=r[s];n.addUserId=this.uid,n.addUserName=this.name,i+=n.total,o+=n.noTaxPrice,n.picUrls=this.toPinjieUrl(n.picUrls),l.push(n)}a.total=i,a.noTaxTotal=o;var u={yuProductList:l,yuBaoJia:a};this.jsonPostRequest("/offer/per/add",u).then(function(a){e.table_loading=!1,a&&200==a.status&&0==a.data.code?(t.$message.success("添加成功"),e.$router.push("/offer/per/list")):t.$message.error(a.data.message)})}},addProduct:function(e){var t=this;this.table_loading=!0;for(var a=this,r=a.productData,o="",l=0;l<r.length;l++){var s=r[l];s.addUserId=this.uid,s.addUserName=this.name,s.yuBaoJiaId=e,s.picUrls=this.toPinjieUrl(s.picUrls),o=o+i()(s)+"|"}var n={yuBaoJiaId:e,yuProducts:o};this.postRequest("/offer/per/add/product",n).then(function(e){t.table_loading=!1,e&&200==e.status&&0==e.data.code?(a.$message.success("添加成功"),t.$router.push("/offer/per/list")):a.$message.error("添加失败")})},deleteRow:function(e,t){t.splice(e,1)},toPinjieUrl:function(e){return(0,this.$options.filters.imageFilter)(e)},toEidtor:function(e,t){this.udapteBoolean=!0;var a;a=t,this.itemRow=a[e],this.elform=this.itemRow,this.itemIndex=e,this.imageUrls=this.itemRow.picUrls,this.innerVisible=!0},toUpdateProduct:function(){var e=this.ruleForm.tax/100+1,t=this.elform.price*this.elform.productNum*e;t=(0,this.$options.filters.toDecimal)(t);for(var a={yuBaoJiaId:"",productName:this.elform.productName,wenlidaima:this.elform.wenlidaima,productNum:this.elform.productNum,area:this.elform.area,dongMo:this.elform.dongMo,coefficient:this.elform.coefficient+"",price:this.elform.total/(this.elform.productNum*this.elform.area),picUrls:this.imageUrls,tax:this.ruleForm.tax,noTaxPrice:this.elform.noTaxPrice,total:this.elform.total,immutable:!1,addUserId:this.uid,addUserName:this.name},r=[],i=0;i<this.productData.length;i++)i==this.itemIndex?r.push(a):r.push(this.productData[i]);this.$nextTick(function(){this.productData=r}),this.imageUrls=[],this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.innerVisible=!1},toAddProduct:function(){var e=this.ruleForm.tax/100+1,t=this.elform.price*this.elform.productNum*e;t=(0,this.$options.filters.toDecimal)(t);var a={yuBaoJiaId:"",productName:this.elform.productName,wenlidaima:this.elform.wenlidaima,productNum:this.elform.productNum,area:this.elform.area,dongMo:this.elform.dongMo,coefficient:this.elform.coefficient,price:this.elform.total/(this.elform.productNum*this.elform.area),picUrls:this.imageUrls,tax:this.ruleForm.tax,noTaxPrice:this.elform.noTaxPrice,total:this.elform.total,immutable:!1,addUserId:this.uid,addUserName:this.name};this.productData.push(a),this.imageUrls=[],this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.innerVisible=!1},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return a.$message.error("请检查输入信息的格式"),!1;t.nowTab=2})},imageuploaded:function(e){if("undefined"!==e.url.length&&e.url.length>0){for(var t=e.url,a=this.imageUrls,r=0;r<t.length;r++)a.push(t[r]);this.imageUrls=a}},delMouldImage:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.todelImage(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},todelImage:function(e){var t=this;"undefined"!=e&&""!=e.length?this.getRequest("/config/delfile/delImage?url="+e).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("删除成功");for(var r=t.imageUrls,i=[],o=0;o<r.length;o++)e!=r[o]&&i.push(r[o]);t.imageUrls=i}else t.$message.error("删除照片失败")}):t.$message.error("删除图片不存在")},loadAllProject:function(){var e=this,t=this;this.getRequest("/offer/per/list/project?addUserId="+this.uid).then(function(a){if(a&&200==a.status&&0==a.data.code){var r=[],i=a.data.data.projectlist;if(e.projectAll=i,"undefined"!=i&&i.length>0){for(var o=0;o<i.length;o++){var l={label:"",value:""};l.label=i[o].projectName,l.value=i[o].id,r.push(l)}t.restaurants3=r}}else console.log("获取列表数据失败")})},handleError:function(){this.$notify.error({title:"上传失败",message:"图片上传出现异常"})}},mounted:function(){this.$nextTick(function(){this.imageData.userId=this.uid=localStorage.getItem("cp_uid"),this.wenjianData.userId=this.uid=localStorage.getItem("cp_uid"),this.upload=l.a.upload}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name"),this.loadAllProject()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("预报价单")]),e._v(" "),a("el-breadcrumb-item",[e._v("添加预报价单")])],1)],1),e._v(" "),a("el-container",[a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px","margin-top":"30px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.nowTab,expression:"nowTab==1"}]},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"简单录入",name:"first"}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-steps",{attrs:{active:e.nowTab}},[a("el-step",{attrs:{title:"基本信息",icon:"el-icon-edit"}}),e._v(" "),a("el-step",{attrs:{title:"报价详情",icon:"el-icon-document"}})],1)],1),e._v(" "),a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"所属项目：",prop:"projectId",required:""}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:e.ruleForm.projectId,callback:function(t){e.$set(e.ruleForm,"projectId",t)},expression:"ruleForm.projectId"}},e._l(e.restaurants3,function(t){return a("el-option",{key:t.value,attrs:{change:e.toSelect1(),label:t.label,value:t.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.carType,callback:function(t){e.$set(e.ruleForm,"carType",t)},expression:"ruleForm.carType"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.clientCompanyName,callback:function(t){e.$set(e.ruleForm,"clientCompanyName",t)},expression:"ruleForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.contactPerson,callback:function(t){e.$set(e.ruleForm,"contactPerson",t)},expression:"ruleForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.contactPhone,callback:function(t){e.$set(e.ruleForm,"contactPhone",t)},expression:"ruleForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.ruleForm.tax,callback:function(t){e.$set(e.ruleForm,"tax",t)},expression:"ruleForm.tax"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1)]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("下一步")])],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"附件上传",name:"second"}},[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"fujianForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.fujianForm,rules:e.rules,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"所属项目：",prop:"projectId",required:""}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:e.fujianForm.projectId,callback:function(t){e.$set(e.fujianForm,"projectId",t)},expression:"fujianForm.projectId"}},e._l(e.restaurants3,function(t){return a("el-option",{key:t.value,attrs:{change:e.toSelect(),label:t.label,value:t.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.carType,callback:function(t){e.$set(e.fujianForm,"carType",t)},expression:"fujianForm.carType"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.clientCompanyName,callback:function(t){e.$set(e.fujianForm,"clientCompanyName",t)},expression:"fujianForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.contactPerson,callback:function(t){e.$set(e.fujianForm,"contactPerson",t)},expression:"fujianForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.contactPhone,callback:function(t){e.$set(e.fujianForm,"contactPhone",t)},expression:"fujianForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"不含税总价：",prop:"noTaxTotal",required:""}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange},model:{value:e.fujianForm.noTaxTotal,callback:function(t){e.$set(e.fujianForm,"noTaxTotal",t)},expression:"fujianForm.noTaxTotal"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.fujianForm.tax,callback:function(t){e.$set(e.fujianForm,"tax",t)},expression:"fujianForm.tax"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"含税总价：",prop:"total",required:""}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange1},model:{value:e.fujianForm.total,callback:function(t){e.$set(e.fujianForm,"total",t)},expression:"fujianForm.total"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.fujianForm.remark,callback:function(t){e.$set(e.fujianForm,"remark",t)},expression:"fujianForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传文件："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.wen_jian_url,expression:"wen_jian_url !== ''"}]},[a("p",{staticStyle:{color:"blue"}},[e._v("上传成功")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:""===e.wen_jian_url,expression:"wen_jian_url === ''"}]},[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,ppt,docx,txt,jpg,xlsx,pdf","max-file-size":5242880,data:e.wenjianData,text:"上传文件",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageupwenjian,errorhandle:e.handleError}})],1)])],1)]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.tiJiao("ruleForm")}}},[e._v("提 交")])],1)],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.nowTab,expression:"nowTab==2"}]},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.table_loading,expression:"table_loading"}],staticClass:"box-card",staticStyle:{"margin-top":"25px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("产品列表")]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:e.toAadd}},[e._v("添加")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productData,border:""}},[a("el-table-column",{attrs:{fixed:"",prop:"productName",label:"产品名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"image",staticStyle:{height:"30px",width:"30px"},attrs:{src:e.row.picUrls[0]}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"wenlidaima",label:"纹理代码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productNum",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"noTaxPrice",label:"不含税总计"}}),e._v(" "),a("el-table-column",{attrs:{prop:"total",label:"含税总计"}}),e._v(" "),a("el-table-column",{attrs:{prop:"area",label:"面积"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.toEidtor(t.$index,e.productData)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.deleteRow(t.$index,e.productData)}}},[e._v("\r\n         移除\r\n       ")])]}}])})],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[a("div",{staticClass:"card-bottom",staticStyle:{float:"left"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.nowTab=1}}},[e._v("上一步")])],1),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.commit}},[e._v("提 交")])],1)])])],1),e._v(" "),a("div",[a("el-dialog",{attrs:{width:"60%",title:"产品详情",visible:e.innerVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("el-form",{ref:"elform",staticStyle:{width:"100%"},attrs:{model:e.elform,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"产品名称：",prop:"productName"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品名称"},model:{value:e.elform.productName,callback:function(t){e.$set(e.elform,"productName",t)},expression:"elform.productName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"纹理代码：",prop:"wenlidaima"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入纹理代码"},model:{value:e.elform.wenlidaima,callback:function(t){e.$set(e.elform,"wenlidaima",t)},expression:"elform.wenlidaima"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品数量：",prop:"productNum"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.elform.productNum,callback:function(t){e.$set(e.elform,"productNum",t)},expression:"elform.productNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"面积：",prop:"area"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.area,callback:function(t){e.$set(e.elform,"area",t)},expression:"elform.area"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有无动模："}},[a("el-switch",{model:{value:e.elform.dongMo,callback:function(t){e.$set(e.elform,"dongMo",t)},expression:"elform.dongMo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系数：",prop:"coefficient"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品系数"},model:{value:e.elform.coefficient,callback:function(t){e.$set(e.elform,"coefficient",t)},expression:"elform.coefficient"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"含税总价：",prop:"total"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange3},model:{value:e.elform.total,callback:function(t){e.$set(e.elform,"total",t)},expression:"elform.total"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"不含税总价：",prop:"noTaxPrice"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange2},model:{value:e.elform.noTaxPrice,callback:function(t){e.$set(e.elform,"noTaxPrice",t)},expression:"elform.noTaxPrice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传图片："}},[a("div",[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,gif,jpeg,jpg","max-file-size":5242880,data:e.imageData,text:"上传图片",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageuploaded,errorhandle:e.handleError}})],1)])],1),e._v(" "),a("div",{staticStyle:{border:"1px dashed #d9d9d9",width:"100%","min-height":"358px"}},[a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},e._l(e.imageUrls,function(t){return a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"mould-card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{height:"320px"},attrs:{src:t}}),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.delMouldImage(t)}}},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}})])],1)])],1)}))],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.udapteBoolean,expression:"!udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toAddProduct}},[e._v("确 定")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.udapteBoolean,expression:"udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toUpdateProduct}},[e._v("更 新")]),e._v(" "),a("el-button",{on:{click:e.chanel}},[e._v("取 消")])],1)],1)],1)])],1)],1)])},staticRenderFns:[]},u=a("Z0/y")(s,n,!1,null,null,null);t.default=u.exports},hMWY:function(e,t){},hgxk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),i=a.n(r),o=a("OIbc"),l=a("+J3q"),s={components:{VueCoreImageUpload:o.default},props:{title:String},data:function(){return{wen_jian_url:"",upload:"",noTaxPrice:"0",totalPrice:"0",fujianForm:{tax:16,noTaxTotal:"0",total:"0"},udapteBoolean:!1,activeName:"first",itemIndex:"",wenjianData:{userId:"",imgPakage:"yu_bao_jia"},itemRow:{},imageData:{userId:"",imgPakage:"yu_bao_jia"},table_loading:!1,imageUrls:[],ruleForm:{tax:"16",addUserId:"",addUserName:""},elform:{productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},productData:[],restaurants3:[],innerVisible:!1,tableData:[],select_word:"",nowTab:1,projectAll:[],rules:{productName:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],wenlidaima:[{required:!0,message:"请输入纹理代码",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],carType:[{required:!0,message:"请输入车型",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],clientCompanyName:[{required:!0,message:"请输入客户单位",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPerson:[{required:!0,message:"请输入预报价单名称",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系人电话",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],paytype:[{required:!0,message:"请输入付款方式",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],deliverytime:[{required:!0,message:"请输入加工周期",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],remark:[{min:0,max:2048,message:"长度在 0 到 2048 个字符",trigger:"blur"}]}}},methods:{toSelect1:function(){if("undefined"!==this.ruleForm.projectId&&"undefined"!=this.projectAll)for(var e=0;e<this.projectAll.length;e++)this.ruleForm.projectId==this.projectAll[e].id&&(this.ruleForm.carType=this.projectAll[e].car.name,this.ruleForm.clientCompanyName=this.projectAll[e].processUnit.clientCompanyName,this.ruleForm.contactPerson=this.projectAll[e].processUnit.contactPerson,this.ruleForm.contactPhone=this.projectAll[e].processUnit.contactPhone)},toSelect:function(){if("undefined"!==this.fujianForm.projectId&&"undefined"!=this.projectAll)for(var e=0;e<this.projectAll.length;e++)this.fujianForm.projectId==this.projectAll[e].id&&(this.fujianForm.carType=this.projectAll[e].car.name,this.fujianForm.clientCompanyName=this.projectAll[e].processUnit.clientCompanyName,this.fujianForm.contactPerson=this.projectAll[e].processUnit.contactPerson,this.fujianForm.contactPhone=this.projectAll[e].processUnit.contactPhone)},toChange:function(){var e=0;e=this.fujianForm.noTaxTotal*(100+this.fujianForm.tax)/100,this.fujianForm.total=e.toFixed(2)},toChange1:function(){var e=0;e=this.fujianForm.total/(100+this.fujianForm.tax)*100,this.fujianForm.noTaxTotal=e.toFixed(2)},toChange2:function(){var e=0;e=this.elform.noTaxPrice*(100+this.ruleForm.tax)/100,this.elform.total=e.toFixed(2)},toChange3:function(){var e=0;e=this.elform.total/(100+this.ruleForm.tax)*100,this.elform.noTaxPrice=e.toFixed(2)},tiJiao:function(){var e=this,t=this;if(""==this.wen_jian_url||this.wen_jian_url.length<=0)this.$message.error("请上传附件");else{var a=t.fujianForm;a.addUserId=this.uid,a.addUserName=this.name,a.submitType=1,a.fuJianUrl=this.wen_jian_url;var r={businessProductList:[],businessBaoJia:a};this.jsonPostRequest("/offer/bus/add",r).then(function(a){a&&200==a.status&&0==a.data.code?(t.$message.success("添加成功"),e.$router.push("/offer/bus/list")):t.$message.error("添加失败")})}},imageupwenjian:function(e){this.$message.success("上传成功");var t;"undefinded"!=(t=e.url)&&t.length>0&&(this.wen_jian_url=t[0])},toAadd:function(){this.innerVisible=!0,this.udapteBoolean=!1,this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.imageUrls=[]},chanel:function(){this.innerVisible=!1,this.udapteBoolean=!1},commit:function(){var e=this.productData;"undefined"==e||e.length<=0?this.$message.error("请添加产品详情"):this.addYuBaoJia()},addYuBaoJia:function(){var e=this,t=this,a=t.ruleForm;a.addUserId=this.uid,a.addUserName=this.name,a.submitType=0,this.table_loading=!0;var r=t.productData;if("undefined"==r||r.length<=0)this.$message.error("请录入产品详情");else{for(var i=0,o=0,l=[],s=0;s<r.length;s++){var n=r[s];n.addUserId=this.uid,n.addUserName=this.name,i+=n.total,o+=n.noTaxPrice,n.picUrls=this.toPinjieUrl(n.picUrls),l.push(n)}a.total=i,a.noTaxTotal=o;var u={businessProductList:l,businessBaoJia:a};this.jsonPostRequest("/offer/bus/add",u).then(function(a){a&&200==a.status&&0==a.data.code?(t.$message.success("添加成功"),e.$router.push("/offer/bus/list")):t.$message.error(a.data.data.message)})}},addProduct:function(e){var t=this;this.table_loading=!0;for(var a=this,r=a.productData,o="",l=0;l<r.length;l++){var s=r[l];s.addUserId=this.uid,s.addUserName=this.name,s.yuBaoJiaId=e,s.picUrls=this.toPinjieUrl(s.picUrls),o=o+i()(s)+"|"}var n={yuBaoJiaId:e,yuProducts:o};this.postRequest("/offer/bus/add/product",n).then(function(e){t.table_loading=!1,e&&200==e.status&&0==e.data.code?(a.$message.success("添加成功"),t.$router.push("/offer/bus/list")):a.$message.error("添加失败")})},deleteRow:function(e,t){t.splice(e,1)},toPinjieUrl:function(e){return(0,this.$options.filters.imageFilter)(e)},toEidtor:function(e,t){this.udapteBoolean=!0;var a;a=t,this.itemRow=a[e],this.elform=this.itemRow,this.itemIndex=e,this.imageUrls=this.itemRow.picUrls,this.innerVisible=!0},toUpdateProduct:function(){var e=this.ruleForm.tax/100+1,t=this.elform.price*this.elform.productNum*e;t=(0,this.$options.filters.toDecimal)(t);for(var a=this.elform.total/this.elform.productNum,r={yuBaoJiaId:"",productName:this.elform.productName,wenlidaima:this.elform.wenlidaima,productNum:this.elform.productNum,area:this.elform.area,dongMo:this.elform.dongMo,price:a/this.elform.area,coefficient:this.elform.coefficient+"",picUrls:this.imageUrls,tax:this.ruleForm.tax,noTaxPrice:this.elform.noTaxPrice,total:this.elform.total,immutable:!1,addUserId:this.uid,addUserName:this.name},i=[],o=0;o<this.productData.length;o++)o==this.itemIndex?i.push(r):i.push(this.productData[o]);this.$nextTick(function(){this.productData=i}),this.imageUrls=[],this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.innerVisible=!1},toAddProduct:function(){var e=this.ruleForm.tax/100+1,t=this.elform.price*this.elform.productNum*e;t=(0,this.$options.filters.toDecimal)(t);var a={yuBaoJiaId:"",productName:this.elform.productName,wenlidaima:this.elform.wenlidaima,productNum:this.elform.productNum,area:this.elform.area,dongMo:this.elform.dongMo,coefficient:this.elform.coefficient,price:this.elform.total/(this.elform.productNum*this.elform.area),picUrls:this.imageUrls,tax:this.ruleForm.tax,noTaxPrice:this.elform.noTaxPrice,total:this.elform.total,immutable:!1,addUserId:this.uid,addUserName:this.name};this.productData.push(a),this.imageUrls=[],this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.innerVisible=!1},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return a.$message.error("请检查输入信息的格式"),!1;t.nowTab=2})},imageuploaded:function(e){if("undefined"!==e.url.length&&e.url.length>0){for(var t=e.url,a=this.imageUrls,r=0;r<t.length;r++)a.push(t[r]);this.imageUrls=a}},delMouldImage:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.todelImage(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},todelImage:function(e){var t=this;"undefined"!=e&&""!=e.length?this.getRequest("/config/delfile/delImage?url="+e).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("删除成功");for(var r=t.imageUrls,i=[],o=0;o<r.length;o++)e!=r[o]&&i.push(r[o]);t.imageUrls=i}else t.$message.error("删除照片失败")}):t.$message.error("删除图片不存在")},loadAllProject:function(){var e=this,t=this;this.getRequest("/offer/bus/list/project?addUserId="+this.uid).then(function(a){if(a&&200==a.status&&0==a.data.code){var r=[],i=a.data.data.projectlist;if(e.projectAll=i,"undefined"!=i&&i.length>0){for(var o=0;o<i.length;o++){var l={label:"",value:""};l.label=i[o].projectName,l.value=i[o].id,r.push(l)}t.restaurants3=r}}else console.log("获取列表数据失败")})},handleError:function(){this.$notify.error({title:"上传失败",message:"图片上传出现异常"})}},mounted:function(){this.$nextTick(function(){this.imageData.userId=this.uid=localStorage.getItem("cp_uid"),this.wenjianData.userId=this.uid=localStorage.getItem("cp_uid"),this.upload=l.a.upload}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name"),this.loadAllProject()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("商务价单")]),e._v(" "),a("el-breadcrumb-item",[e._v("添加商务价单")])],1)],1),e._v(" "),a("el-container",[a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px","margin-top":"30px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.nowTab,expression:"nowTab==1"}]},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"简单录入",name:"first"}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-steps",{attrs:{active:e.nowTab}},[a("el-step",{attrs:{title:"基本信息",icon:"el-icon-edit"}}),e._v(" "),a("el-step",{attrs:{title:"报价详情",icon:"el-icon-document"}})],1)],1),e._v(" "),a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"所属项目：",prop:"projectId",required:""}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:e.ruleForm.projectId,callback:function(t){e.$set(e.ruleForm,"projectId",t)},expression:"ruleForm.projectId"}},e._l(e.restaurants3,function(t){return a("el-option",{key:t.value,attrs:{change:e.toSelect1(),label:t.label,value:t.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.carType,callback:function(t){e.$set(e.ruleForm,"carType",t)},expression:"ruleForm.carType"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.clientCompanyName,callback:function(t){e.$set(e.ruleForm,"clientCompanyName",t)},expression:"ruleForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.contactPerson,callback:function(t){e.$set(e.ruleForm,"contactPerson",t)},expression:"ruleForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.ruleForm.contactPhone,callback:function(t){e.$set(e.ruleForm,"contactPhone",t)},expression:"ruleForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.ruleForm.tax,callback:function(t){e.$set(e.ruleForm,"tax",t)},expression:"ruleForm.tax"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1)]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("下一步")])],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"附件上传",name:"second"}},[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"fujianForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.fujianForm,rules:e.rules,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"所属项目：",prop:"projectId",required:""}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:e.fujianForm.projectId,callback:function(t){e.$set(e.fujianForm,"projectId",t)},expression:"fujianForm.projectId"}},e._l(e.restaurants3,function(t){return a("el-option",{key:t.value,attrs:{change:e.toSelect(),label:t.label,value:t.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.carType,callback:function(t){e.$set(e.fujianForm,"carType",t)},expression:"fujianForm.carType"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.clientCompanyName,callback:function(t){e.$set(e.fujianForm,"clientCompanyName",t)},expression:"fujianForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.contactPerson,callback:function(t){e.$set(e.fujianForm,"contactPerson",t)},expression:"fujianForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.fujianForm.contactPhone,callback:function(t){e.$set(e.fujianForm,"contactPhone",t)},expression:"fujianForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"不含税总价：",prop:"noTaxTotal",required:""}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange},model:{value:e.fujianForm.noTaxTotal,callback:function(t){e.$set(e.fujianForm,"noTaxTotal",t)},expression:"fujianForm.noTaxTotal"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.fujianForm.tax,callback:function(t){e.$set(e.fujianForm,"tax",t)},expression:"fujianForm.tax"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"含税总价：",prop:"total",required:""}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange1},model:{value:e.fujianForm.total,callback:function(t){e.$set(e.fujianForm,"total",t)},expression:"fujianForm.total"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.fujianForm.remark,callback:function(t){e.$set(e.fujianForm,"remark",t)},expression:"fujianForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传文件："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.wen_jian_url,expression:"wen_jian_url !== ''"}]},[a("p",{staticStyle:{color:"blue"}},[e._v("上传成功")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:""===e.wen_jian_url,expression:"wen_jian_url === ''"}]},[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,ppt,docx,txt,jpg,xlsx,pdf","max-file-size":5242880,data:e.wenjianData,text:"上传文件",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageupwenjian,errorhandle:e.handleError}})],1)])],1)]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.tiJiao("ruleForm")}}},[e._v("提 交")])],1)],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.nowTab,expression:"nowTab==2"}]},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.table_loading,expression:"table_loading"}],staticClass:"box-card",staticStyle:{"margin-top":"25px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("产品列表")]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:e.toAadd}},[e._v("添加")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productData,border:""}},[a("el-table-column",{attrs:{fixed:"",prop:"productName",label:"产品名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"image",staticStyle:{height:"30px",width:"30px"},attrs:{src:e.row.picUrls[0]}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"wenlidaima",label:"纹理代码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productNum",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"noTaxPrice",label:"不含税总计"}}),e._v(" "),a("el-table-column",{attrs:{prop:"total",label:"含税总计"}}),e._v(" "),a("el-table-column",{attrs:{prop:"area",label:"面积"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.toEidtor(t.$index,e.productData)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.deleteRow(t.$index,e.productData)}}},[e._v("\r\n         移除\r\n       ")])]}}])})],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[a("div",{staticClass:"card-bottom",staticStyle:{float:"left"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.nowTab=1}}},[e._v("上一步")])],1),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.commit}},[e._v("提 交")])],1)])])],1),e._v(" "),a("div",[a("el-dialog",{attrs:{width:"60%",title:"产品详情",visible:e.innerVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("el-form",{ref:"elform",staticStyle:{width:"100%"},attrs:{model:e.elform,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"产品名称：",prop:"productName"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品名称"},model:{value:e.elform.productName,callback:function(t){e.$set(e.elform,"productName",t)},expression:"elform.productName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"纹理代码：",prop:"wenlidaima"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入纹理代码"},model:{value:e.elform.wenlidaima,callback:function(t){e.$set(e.elform,"wenlidaima",t)},expression:"elform.wenlidaima"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品数量：",prop:"productNum"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.elform.productNum,callback:function(t){e.$set(e.elform,"productNum",t)},expression:"elform.productNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"面积：",prop:"area"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.area,callback:function(t){e.$set(e.elform,"area",t)},expression:"elform.area"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有无动模："}},[a("el-switch",{model:{value:e.elform.dongMo,callback:function(t){e.$set(e.elform,"dongMo",t)},expression:"elform.dongMo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系数：",prop:"coefficient"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品系数"},model:{value:e.elform.coefficient,callback:function(t){e.$set(e.elform,"coefficient",t)},expression:"elform.coefficient"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"含税总价：",prop:"total"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange3},model:{value:e.elform.total,callback:function(t){e.$set(e.elform,"total",t)},expression:"elform.total"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"不含税总价：",prop:"noTaxPrice"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},on:{blur:e.toChange2},model:{value:e.elform.noTaxPrice,callback:function(t){e.$set(e.elform,"noTaxPrice",t)},expression:"elform.noTaxPrice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传图片："}},[a("div",[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,gif,jpeg,jpg","max-file-size":5242880,data:e.imageData,text:"上传图片",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageuploaded,errorhandle:e.handleError}})],1)])],1),e._v(" "),a("div",{staticStyle:{border:"1px dashed #d9d9d9",width:"100%","min-height":"358px"}},[a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},e._l(e.imageUrls,function(t){return a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"mould-card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{height:"320px"},attrs:{src:t}}),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.delMouldImage(t)}}},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}})])],1)])],1)}))],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.udapteBoolean,expression:"!udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toAddProduct}},[e._v("确 定")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.udapteBoolean,expression:"udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toUpdateProduct}},[e._v("更 新")]),e._v(" "),a("el-button",{on:{click:e.chanel}},[e._v("取 消")])],1)],1)],1)])],1)],1)])},staticRenderFns:[]},u=a("Z0/y")(s,n,!1,null,null,null);t.default=u.exports},oyck:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),i=a.n(r),o=a("a3Yh"),l=a.n(o),s=a("OIbc"),n=a("+J3q"),u={components:{VueCoreImageUpload:s.default},props:{title:String},data:function(){var e;return e={remarks:[],wen_jian_url:"",wenjianData:{userId:"",imgPakage:"yu_bao_jia"},imageData:{userId:"",imgPakage:"order_pm"},itemRow:{},upload:"",itemIndex:"",innerVisible:!1,udapteBoolean:!1,urlId:"",table_loading:!1,imageUrls:[],ruleForm:{tax:"16",addUserId:"",addUserName:""},rules:{productName:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],projectId:[{required:!0,message:"请选择项目",trigger:"blur"}],wenlidaima:[{required:!0,message:"请输入纹理代码",trigger:"blur"},{min:0,max:255,message:"长度在 0 到 255 个字符",trigger:"blur"}],carType:[{required:!0,message:"请输入车型",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],clientCompanyName:[{required:!0,message:"请输入客户单位",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPerson:[{required:!0,message:"请输入预报价单名称",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系人电话",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],paytype:[{required:!0,message:"请输入付款方式",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],deliverytime:[{required:!0,message:"请输入加工周期",trigger:"blur"},{min:1,max:255,message:"长度在 1 到 255 个字符",trigger:"blur"}],remark:[{min:0,max:2048,message:"长度在 0 到 2048 个字符",trigger:"blur"}]},elform:{},productData:[]},l()(e,"innerVisible",!1),l()(e,"tableData",[]),l()(e,"select_word",""),l()(e,"nowTab",1),e},methods:{toback:function(){this.$router.push("/offer/bus/list")},toDownLoad:function(e){window.open(e)},toimageupwenjian:function(e){var t=this;this.$confirm("此操作将覆盖原上传文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.imageupwenjian(e)}).catch(function(){t.$message({type:"info",message:"已取消上传"})})},imageupwenjian:function(e){var t;t=e.url,this.wen_jian_url=t[0],this.ruleForm.fileUrl=this.wen_jian_url,this.$message.success("上传成功")},toAgain:function(){var e=this;this.postRequest("/offer/bus/again/audit",this.ruleForm).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("重新提交成功"),e.$router.push("/offer/bus/list/")):e.$message.error("重新提交失败")})},toadd:function(){this.innerVisible=!0,this.elform={productNum:"1",area:"0",price:"0",coefficient:"1",dongMo:!1},this.imageUrls=[]},commit:function(){var e=this.productData;"undefined"==e||e.length<=0?this.$message.error("请添加产品详情"):this.addYuBaoJia()},addYuBaoJia:function(){var e=this,t=this,a=t.ruleForm;a.addUserId=this.uid,a.addUserName=this.name,a.submitType=0,this.postRequest("/offer/bus/add",a).then(function(a){if(a&&200==a.status&&0==a.data.code){var r=a.data.data.id;r>0?e.addProduct(r):t.$message.error("添加基础信息失败")}else t.$message.error("添加基础信息失败")})},addProduct:function(e){var t=this;this.table_loading=!0;for(var a=this,r=a.productData,o="",l=0;l<r.length;l++){var s=r[l];s.addUserId=this.uid,s.addUserName=this.name,s.yuBaoJiaId=e,s.picUrls=this.toPinjieUrl(s.picUrls),o=o+i()(s)+"|"}var n={yuBaoJiaId:e,yuProducts:o};this.postRequest("/offer/bus/add/product",n).then(function(e){t.table_loading=!1,e&&200==e.status&&0==e.data.code?(a.$message.success("添加成功"),t.$router.push("/offer/bus/list")):a.$message.error("添加失败")})},deleteRow:function(e,t){var a=t[e].id;this.delProduct(a,e,t)},toAadd:function(){this.innerVisible=!0,this.udapteBoolean=!1,this.resetForm("elform")},toEidtor:function(e,t){this.udapteBoolean=!0;var a;a=t,this.itemRow=a[e],this.elform=this.itemRow,this.imageUrls=this.itemRow.picUrls,this.itemIndex=e,this.innerVisible=!0},todelProduct:function(e,t,a){var r=this,i=a[t];this.postRequest("/offer/bus/del?product=",i).then(function(e){e&&200==e.status&&0==e.data.code?(r.$message.success("删除成功"),a.splice(t,1)):self.$message.error("删除失败")})},delProduct:function(e,t,a){var r=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.todelProduct(e,t,a)}).catch(function(){r.$message({type:"info",message:"已取消删除"})})},delMouldImage:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.todelImage(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},todelImage:function(e){var t=this;"undefined"!=e&&""!=e.length?this.getRequest("/config/delfile/delImage?url="+e).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("删除成功");for(var r=t.imageUrls,i=[],o=0;o<r.length;o++)e!=r[o]&&i.push(r[o]);t.imageUrls=i}else t.$message.error("删除照片失败")}):t.$message.error("删除图片不存在")},splitUrl:function(e){var t=e.picUrls,a=[];return"undefined"!=t&&""!=t&&(a=t.split("|")),a},toAudit:function(e){var t=this,a={id:this.urlId,audit:e,addUserId:this.ruleForm.addUserId,auditId:this.uid,auditName:this.name};this.postRequest("/audit/bus/check",a).then(function(e){e&&200==e.status&&0==e.data.code?(t.$message.success("执行成功"),t.$store.state.stomp.send("/ws/nf",{},""),t.$router.push("/audit/bus")):t.$message.error("执行失败")})},handleError:function(){this.$notify.error({title:"上传失败",message:"图片上传出现异常"})},toAddProduct:function(){var e=this,t=e.elform.price*e.elform.productNum*(e.ruleForm.tax/100+1),a=(0,this.$options.filters.imageFilter)(e.imageUrls),r={yuBaoJiaId:e.ruleForm.id,productName:e.elform.productName,wenlidaima:e.elform.wenlidaima,productNum:e.elform.productNum,area:e.elform.area,dongMo:e.elform.dongMo,coefficient:e.elform.coefficient,price:e.elform.price,picUrls:a,tax:e.ruleForm.tax,noTaxPrice:e.elform.price*e.elform.productNum,total:t,immutable:!1,addUserId:this.uid,addUserName:this.name};this.postRequest("/offer/bus/add/new/product",r).then(function(t){t&&200==t.status&&0==t.data.code?(e.$message.success("新增成功"),r.picUrls=e.imageUrls,e.productData.push(r),e.imageUrls=[],e.resetForm("elform"),e.innerVisible=!1):e.$message.error("新增失败")})},imageuploaded:function(e){if("undefined"!==e.url.length&&e.url.length>0){for(var t=e.url,a=this.imageUrls,r=0;r<t.length;r++)a.push(t[r]);this.imageUrls=a}},getInfo:function(e){var t=this,a=this;this.getRequest("/offer/bus/info?id="+e).then(function(e){if(e&&200==e.status&&0==e.data.code){a.ruleForm=e.data.data.businfo;var r=e.data.data.businfo.businessProductList,i=e.data.data.businfo.rejectRemark,o=t.$options.filters.splitRejectRemark;if(t.remarks=o(i),"undefined"!=a.product&&r.length>0){for(var l=[],s=0;s<r.length;s++){var n,u={};u=r[s],n=(o=t.$options.filters.splitUrl)(r[s].picUrls),u.picUrls=n,l.push(u)}a.productData=l}}else a.$message.error("获取失败")})},toUpdateProduct:function(){var e=this,t=this,a=t.elform.price*t.elform.productNum*(t.ruleForm.tax/100+1),r=(0,this.$options.filters.imageFilter)(t.imageUrls),i={yuBaoJiaId:t.ruleForm.id,id:t.elform.id,productName:t.elform.productName,wenlidaima:t.elform.wenlidaima,productNum:t.elform.productNum,area:t.elform.area,dongMo:t.elform.dongMo,coefficient:t.elform.coefficient,price:t.elform.price,picUrls:r,tax:t.ruleForm.tax,noTaxPrice:t.elform.price*t.elform.productNum,total:a,immutable:!1,addUserId:this.uid,addUserName:this.name};this.postRequest("/offer/bus/update/product",i).then(function(a){if(a&&200==a.status&&0==a.data.code){t.$message.success("更新成功");var r=[];i.picUrls=t.imageUrls;for(var o=0;o<e.productData.length;o++)o==e.itemIndex?r.push(i):r.push(e.productData[o]);e.$nextTick(function(){this.productData=r}),t.imageUrls=[],t.resetForm("elform"),t.innerVisible=!1}else t.$message.error("更新失败")})},chanel:function(){this.innerVisible=!1,this.udapteBoolean=!1},resetForm:function(e){this.$refs[e].resetFields()}},mounted:function(){this.$nextTick(function(){this.imageData.userId=this.uid=localStorage.getItem("cp_uid"),this.wenjianData.userId=this.uid=localStorage.getItem("cp_uid"),this.upload=n.a.upload}),this.username=localStorage.getItem("cp_username"),this.uid=localStorage.getItem("cp_uid"),this.name=localStorage.getItem("cp_name"),this.upload=n.a.upload},created:function(){this.urlId=this.$route.params.id,this.getInfo(this.urlId)}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),e._v("商务价单")]),e._v(" "),a("el-breadcrumb-item",[e._v("商务报价详情")])],1)],1),e._v(" "),a("el-container",[a("el-main",{staticStyle:{"padding-left":"0px","padding-top":"0px"}},[e.ruleForm.audit+""=="2"?a("div",[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("span",[e._v("驳回原因:")]),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},e._l(e.remarks,function(e){return a("div",[a("el-alert",{attrs:{title:e,type:"warning",closable:!1}})],1)}))])],1):e._e(),e._v(" "),a("div",[a("el-card",{staticStyle:{"margin-top":"30px"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"40%"},attrs:{model:e.ruleForm,"label-width":"110px"}},[a("div",[a("el-form-item",{attrs:{label:"客户单位：",prop:"clientCompanyName"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.clientCompanyName,callback:function(t){e.$set(e.ruleForm,"clientCompanyName",t)},expression:"ruleForm.clientCompanyName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人：",prop:"contactPerson"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.contactPerson,callback:function(t){e.$set(e.ruleForm,"contactPerson",t)},expression:"ruleForm.contactPerson"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话：",prop:"contactPhone"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.contactPhone,callback:function(t){e.$set(e.ruleForm,"contactPhone",t)},expression:"ruleForm.contactPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"车型：",prop:"carType"}},[a("el-input",{attrs:{disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.carType,callback:function(t){e.$set(e.ruleForm,"carType",t)},expression:"ruleForm.carType"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"不含税总价：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.noTaxTotal,callback:function(t){e.$set(e.ruleForm,"noTaxTotal",t)},expression:"ruleForm.noTaxTotal"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"税率：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.tax,callback:function(t){e.$set(e.ruleForm,"tax",t)},expression:"ruleForm.tax"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"含税总价：",prop:"tax"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.total,callback:function(t){e.$set(e.ruleForm,"total",t)},expression:"ruleForm.total"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"最终优惠价格：",prop:"finalBaoJia"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0,disabled:!0},model:{value:e.ruleForm.finalBaoJia,callback:function(t){e.$set(e.ruleForm,"finalBaoJia",t)},expression:"ruleForm.finalBaoJia"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",disabled:e.ruleForm.audit+""!="2"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1),e._v(" "),e.ruleForm.submitType+""=="1"?a("el-form-item",{attrs:{label:"下载原文件",prop:"remark"}},[[a("a",{staticStyle:{color:"blue"},attrs:{href:e.ruleForm.fuJianUrl,download:"w3logo"}},[e._v("下载原文件")])]],2):e._e(),e._v(" "),e.ruleForm.submitType+""=="1"&&e.ruleForm.audit+""=="2"?a("el-form-item",{attrs:{label:"重新上传文件："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.wen_jian_url,expression:"wen_jian_url !== ''"}]},[a("p",{staticStyle:{color:"blue"}},[e._v("上传成功")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:""===e.wen_jian_url,expression:"wen_jian_url === ''"}]},[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,ppt,docx,txt,jpg,xlsx,pdf","max-file-size":5242880,data:e.wenjianData,text:"重新上传文件",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.toimageupwenjian,errorhandle:e.handleError}})],1)]):e._e()],1)])],1)],1),e._v(" "),e.ruleForm.submitType+""=="0"?a("div",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.table_loading,expression:"table_loading"}],staticClass:"box-card",staticStyle:{"margin-top":"25px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("产品列表")]),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[e.ruleForm.audit+""=="2"?a("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:e.toadd}},[e._v("添加")]):e._e()],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productData,border:""}},[a("el-table-column",{attrs:{fixed:"",prop:"productName",label:"产品名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"image",staticStyle:{height:"30px",width:"30px"},attrs:{src:e.row.picUrls[0]}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"图片地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:t.row.picUrls[0],target:"_blank"}},[e._v("点击查看")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"wenlidaima",label:"纹理代码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productNum",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"total",label:"含税"}}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"area",label:"面积"}}),e._v(" "),a("el-table-column",{attrs:{prop:"noTaxPrice",label:"不含税价格"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.ruleForm.audit+""=="2"?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.toEidtor(t.$index,e.productData)}}},[e._v("编辑")]):e._e(),e._v(" "),e.ruleForm.audit+""=="2"?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){a.preventDefault(),e.deleteRow(t.$index,e.productData)}}},[e._v("\r\n                      移除\r\n                    ")]):e._e()]}}])})],1)],1)])],1):e._e(),e._v(" "),a("div",{staticClass:"card-bottom",staticStyle:{float:"left","margin-top":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.toback}},[e._v("返回列表")])],1),e._v(" "),e.ruleForm.audit+""=="2"?a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[a("div",{staticClass:"card-bottom",staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.toAgain}},[e._v("重新提交")])],1)]):e._e(),e._v(" "),a("div",[a("el-dialog",{attrs:{width:"60%",title:"产品详情",visible:e.innerVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("el-form",{ref:"elform",staticStyle:{width:"100%"},attrs:{model:e.elform,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"产品名称：",prop:"productName"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品名称"},model:{value:e.elform.productName,callback:function(t){e.$set(e.elform,"productName",t)},expression:"elform.productName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"纹理代码：",prop:"wenlidaima"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入纹理代码"},model:{value:e.elform.wenlidaima,callback:function(t){e.$set(e.elform,"wenlidaima",t)},expression:"elform.wenlidaima"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品数量：",prop:"productNum"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.elform.productNum,callback:function(t){e.$set(e.elform,"productNum",t)},expression:"elform.productNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"面积：",prop:"area"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.area,callback:function(t){e.$set(e.elform,"area",t)},expression:"elform.area"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有无动模："}},[a("el-switch",{model:{value:e.elform.dongMo,callback:function(t){e.$set(e.elform,"dongMo",t)},expression:"elform.dongMo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系数：",prop:"coefficient"}},[a("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入产品系数"},model:{value:e.elform.coefficient,callback:function(t){e.$set(e.elform,"coefficient",t)},expression:"elform.coefficient"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单价：",prop:"price"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.elform.price,callback:function(t){e.$set(e.elform,"price",t)},expression:"elform.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传图片："}},[a("div",[a("vue-core-image-upload",{class:["el-button","el-button--primary"],attrs:{crop:!1,inputOfFile:"imageFile",url:e.upload,extensions:"png,gif,jpeg,jpg","max-file-size":5242880,data:e.imageData,text:"上传图片",multiple:!0,"multiple-size":30,credentials:"true"},on:{imageuploaded:e.imageuploaded,errorhandle:e.handleError}})],1)])],1),e._v(" "),a("div",{staticStyle:{border:"1px dashed #d9d9d9",width:"100%","min-height":"358px"}},[a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},e._l(e.imageUrls,function(t){return a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"mould-card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{height:"320px"},attrs:{src:t}}),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.delMouldImage(t)}}},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}})])],1)])],1)}))],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.udapteBoolean,expression:"!udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toAddProduct}},[e._v("确 定")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.udapteBoolean,expression:"udapteBoolean"}],attrs:{type:"primary"},on:{click:e.toUpdateProduct}},[e._v("更 新")]),e._v(" "),a("el-button",{on:{click:e.chanel}},[e._v("取 消")])],1)],1)],1)])],1)],1)])},staticRenderFns:[]},m=a("Z0/y")(u,c,!1,null,null,null);t.default=m.exports},tQgA:function(e,t){}});
//# sourceMappingURL=7.a70f92fdb324bf42cf8e.js.map